#Run in playbook
apt-get update && apt-get install docker.io

#unifi controller example
docker volume create unifi-controller
docker create --name=unifi-controller -e PUID=1000 -e PGID=1000 -e MEM_LIMIT=1024M -p 3478:3478/udp -p 10001:10001/udp -p 8080:8080 -p 8081:8081 -p 8443:8443 -p 8843:8843 -p 8880:8880 -p 6789:6789 -v unifi-controller:/config --restart unless-stopped linuxserver/unifi-controller

cat >> /etc/systemd/system/unifi-controller.service << EOF
[Unit]
Description=Unifi Controller container from linuxserver.io
After=docker.service
Requires=docker.service

[Service]
TimeoutStartSec=0
Restart=always
#Should this service check for container updates first?
#ExecStartPre=-/usr/bin/docker pull unifi-controller
ExecStartPre=-/usr/bin/docker stop unifi-controller
ExecStart=/usr/bin/docker start -a unifi-controller
ExecStop=/usr/bin/docker stop -t 2 unifi-controller

[Install]
WantedBy=multi-user.target
EOF

systemctl enable unifi-controller

